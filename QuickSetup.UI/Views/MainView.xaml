<controls:MetroWindow x:Class="QuickSetup.UI.Views.MainView"
                      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                      xmlns:controls="http://metro.mahapps.com/winfx/xaml/controls"
                      xmlns:converters="clr-namespace:QuickSetup.UI.Resources.Converters"
                      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                      xmlns:enums="clr-namespace:QuickSetup.Logic.Infra.Enums;assembly=QuickSetup.Logic"
                      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                      xmlns:sys="clr-namespace:System;assembly=mscorlib"
                      xmlns:viewModel="clr-namespace:QuickSetup.UI.ViewModel"
                      xmlns:xcdg="http://schemas.xceed.com/wpf/xaml/datagrid"
                      xmlns:models="clr-namespace:QuickSetup.Logic.Models;assembly=QuickSetup.Logic"
                      Title="Quick Setup"
                      Width="900"
                      Height="350"
                      d:DataContext="{d:DesignInstance Type=viewModel:MainViewModel,
                                                       IsDesignTimeCreatable=True}"
                      BorderThickness="5"
                      DataContext="{Binding Path=Main,
                                            Source={StaticResource Locator}}"
                      ResizeMode="CanResizeWithGrip"
                      mc:Ignorable="d">
    <Window.CommandBindings>
        <CommandBinding Command="ApplicationCommands.Close" Executed="CommandBinding_OnExecuted" />
    </Window.CommandBindings>
    <Window.Resources>
        <ResourceDictionary>
            <!--
                list of MahApps icons
                http://www.barth-dev.de/misc/stack/mahapps-icons-list/
            -->

            <!--<VisualBrush x:Key="SaveIcon" Visual="{StaticResource appbar_save}" />-->
            <converters:SoftwareStatusToImageConverter x:Key="MySoftwareStatusToImageConverter" />

            <ObjectDataProvider x:Key="MySoftwareInstallStatusEnum"
                                MethodName="GetValues"
                                ObjectType="{x:Type sys:Enum}">
                <ObjectDataProvider.MethodParameters>
                    <x:Type TypeName="enums:SoftwareInstallStatusEnum" />
                </ObjectDataProvider.MethodParameters>
            </ObjectDataProvider>
        </ResourceDictionary>
    </Window.Resources>

    <DockPanel>
        
        <StatusBar DockPanel.Dock="Bottom">
            <StatusBarItem HorizontalContentAlignment="Right">
                <TextBlock HorizontalAlignment="Right" FontSize="8">
                    <Run Text="This Project is using the following products:" />
                    <LineBreak />
                    <Run Text="MS .Net, Log4Net, MahApps.Metro, Xceed WPF, GalaSoft.MvvmLight, FlatIcon.com" />
                </TextBlock>
            </StatusBarItem>
        </StatusBar>

        <Grid>

            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!--  Grid of apps  -->
            <DockPanel Grid.Row="0">
                <ToolBar DockPanel.Dock="Top">
                    <Button Command="{Binding Path=ScanFolderCommand}">
                        <StackPanel Orientation="Horizontal">
                            <Rectangle Width="20" Height="20">
                                <Rectangle.Fill>
                                    <VisualBrush Visual="{StaticResource appbar_beer}" />
                                </Rectangle.Fill>
                            </Rectangle>
                            <TextBlock Margin="5,0"
                                       VerticalAlignment="Center"
                                       Text="Re-Scan Root Folder" />
                        </StackPanel>
                    </Button>

                    <!--<Button Command="Close"
                               >
                        <StackPanel Orientation="Horizontal">
                            <Rectangle Width="20" Height="20">
                                <Rectangle.Fill>
                                    <VisualBrush Visual="{StaticResource appbar_close}" />
                                </Rectangle.Fill>
                            </Rectangle>
                            <TextBlock Margin="5,0"
                                       VerticalAlignment="Center"
                                       Text="Exit" />
                        </StackPanel>
                        
                    </Button>-->
                </ToolBar>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition />
                        <ColumnDefinition Width="5" />
                        <ColumnDefinition />
                    </Grid.ColumnDefinitions>

                    <DockPanel Grid.Column="0">
                        <TextBlock DockPanel.Dock="Top" Text="Folder Tree" FontWeight="Bold" FontSize="14" />

                        <TreeView  x:Name="softwareTree" ItemsSource="{Binding Path=FoldersList}" >
                            <TreeView.Resources>
                                <!--how to display a "SoftwareDirectoryModel"-->
                                <HierarchicalDataTemplate  DataType="{x:Type viewModel:SoftwareDirectoryViewModel}"
                                                   ItemsSource="{Binding Path=SubDirs}">
                                    <StackPanel Orientation="Horizontal">
                                        <Image Source="{Binding Path=Status, Converter={StaticResource MySoftwareStatusToImageConverter}}" Width="24" Height="24"/>
                                        <TextBlock Text="{Binding Name}"  VerticalAlignment="Center"/>
                                    </StackPanel>
                                </HierarchicalDataTemplate>

                              

                                <!--<Style TargetType="{x:Type TreeViewItem}" BasedOn="{StaticResource {x:Type TreeViewItem}}">
                                    <Setter Property="ContextMenu"  >
                                        <Setter.Value>
                                           

                                        </Setter.Value>
                                    </Setter>
                                </Style>-->

                                <ContextMenu x:Key="SoftwareRightClickMenu" >
                                    <MenuItem Header="Install" Command="{Binding Path=InstallSoftwareCommand}" />
                                    <Separator />
                                    <MenuItem Header="Edit/Create QS Settings..." Command="{Binding Path=EditQSSettingsCommand}" />
                                    <MenuItem Header="Browse" Command="{Binding Path=BrowseCommand}" />
                                </ContextMenu>
                            </TreeView.Resources>

                            <TreeView.ItemContainerStyle>
                                <Style TargetType="{x:Type TreeViewItem}">
                                    <Setter Property="Tag" Value="{Binding Path=DataContext, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}"/>
                                    <Setter Property="ContextMenu" Value="{Binding Source={StaticResource SoftwareRightClickMenu}}"/>
                                </Style>
                            </TreeView.ItemContainerStyle>
                        </TreeView>
                    </DockPanel>

                    <GridSplitter Grid.Column="1" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" />

                    <DockPanel Grid.Column="2">
                        <TextBlock DockPanel.Dock="Top" Text="Selected folder" FontWeight="Bold" FontSize="14" />
                    </DockPanel>
                </Grid>

                <!--<TreeView ItemsSource="{Binding Path=SoftwareList}" />-->

                <!--<xcdg:DataGridControl Margin="5"
                                      Visibility="Collapsed"
                                      AutoCreateColumns="False"
                                      AutoScrollCurrentItem="All"
                                      ItemsSource="{Binding Path=SoftwareList,
                                                            Mode=OneWay}"
                                      SelectedItem="{Binding Path=SelectedSoftware,
                                                             Mode=TwoWay,
                                                             UpdateSourceTrigger=PropertyChanged}">

                    <xcdg:DataGridControl.View>
                        <xcdg:TableflowView ContainerHeight="55" ShowRowSelectorPane="False" />
                    </xcdg:DataGridControl.View>

                    <xcdg:DataGridControl.Columns>

                        <xcdg:Column Title="Install?"
                                     Width="60"
                                     MinWidth="50"
                                     MaxWidth="70"
                                     FieldName="IsChecked">
                            <xcdg:Column.CellContentTemplate>
                                <DataTemplate>
                                    <CheckBox IsChecked="{xcdg:CellEditorBinding}" />
                                </DataTemplate>
                            </xcdg:Column.CellContentTemplate>
                        </xcdg:Column>

                        <xcdg:Column Title="Software Name"
                                     Width="180"
                                     FieldName="SoftwareName"
                                     IsMainColumn="True"
                                     ReadOnly="True">
                            <xcdg:Column.CellContentTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock VerticalAlignment="Center"
                                                   Text="{Binding}"
                                                   ToolTip="{Binding Path=NotesToolTip,
                                                                     Mode=OneWay,
                                                                     UpdateSourceTrigger=PropertyChanged}" />
                                        <Image Source="{Binding}" />
                                    </StackPanel>
                                </DataTemplate>
                            </xcdg:Column.CellContentTemplate>
                        </xcdg:Column>

                        -->
                <!--<xcdg:Column Title="Language"
                                     Width="70"
                                     FieldName="OriginalModel.LangCodeIso6392"
                                     IsMainColumn="False"
                                     ReadOnly="True" />-->

                <!--<xcdg:Column Title="Setup Folder"
                                     Width="180"
                                     FieldName="OriginalModel.SetupFolder"
                                     IsMainColumn="True"
                                     ReadOnly="True"
                                     Visible="{Binding Path=IsDev,
                                                       Mode=OneWay}" />-->
                <!--

                        <xcdg:Column Title="Status"
                                     FieldName="Status"
                                     IsMainColumn="False"
                                     ReadOnly="True">
                            <xcdg:Column.CellContentTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" ToolTip="{Binding}">
                                        <Image Width="20"
                                               Height="20"
                                               Source="{Binding Converter={StaticResource ResourceKey=MySoftwareStatusToImageConverter},
                                                                Mode=OneWay}" />
                                        <TextBlock VerticalAlignment="Center"
                                                   FontSize="10"
                                                   Text="{Binding Converter={converters:EnumDescriptionConverter}}" />
                                    </StackPanel>
                                </DataTemplate>
                            </xcdg:Column.CellContentTemplate>
                        </xcdg:Column>

                        <xcdg:UnboundColumn Title="Operations"
                                            MinWidth="180"
                                            FieldName="FakeColumnName">
                            <xcdg:UnboundColumn.CellContentTemplate>

                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        -->
                <!--
                                            Commands are not working with Xceed UnboundColumn. no idea why
                                            Command="{Binding Path=ParentRow.Row.InstallCommand}"
                                        -->
                <!--
                                        <Button MinWidth="50"
                                                Margin="3,0,3,0"
                                                Click="ButtonInstall_OnClick"
                                                Padding="0"
                                                ToolTip="Install">
                                            <Button.Template>
                                                <ControlTemplate>
                                                    <Rectangle Width="30"
                                                               Height="30"
                                                               Stroke="LightYellow">
                                                        <Rectangle.Fill>
                                                            <VisualBrush Visual="{StaticResource appbar_cabinet_in}" />
                                                        </Rectangle.Fill>
                                                    </Rectangle>
                                                </ControlTemplate>
                                            </Button.Template>
                                        </Button>

                                        -->
                <!--
                                            Commands are not working with Xceed UnboundColumn. no idea why
                                            Command="{Binding Path=DataGridContext.EditAppCommand}"
                                        -->
                <!--
                                        <StackPanel>
                                            <Button MinWidth="50"
                                                    Click="ButtonEdit_OnClick"
                                                    Padding="0"
                                                    ToolTip="Edit Setup Settings">
                                                <Button.Template>
                                                    <ControlTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <Rectangle Width="13" Height="13">

                                                                <Rectangle.Fill>
                                                                    <VisualBrush Visual="{StaticResource appbar_edit}" />
                                                                </Rectangle.Fill>
                                                            </Rectangle>
                                                            <TextBlock Margin="3,0"
                                                                       VerticalAlignment="Center"
                                                                       Text="Edit" />
                                                        </StackPanel>
                                                    </ControlTemplate>
                                                </Button.Template>
                                            </Button>

                                            <Button MinWidth="50"
                                                    Click="ButtonRemove_OnClick"
                                                    Padding="0"
                                                    ToolTip="Uninstall">
                                                <Button.Template>
                                                    <ControlTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <Rectangle Width="12" Height="12">
                                                                <Rectangle.Fill>
                                                                    <VisualBrush Visual="{StaticResource appbar_app_remove}" />
                                                                </Rectangle.Fill>
                                                            </Rectangle>
                                                            <TextBlock Margin="3,0"
                                                                       VerticalAlignment="Center"
                                                                       Text="Uninstall" />
                                                        </StackPanel>
                                                    </ControlTemplate>
                                                </Button.Template>
                                            </Button>
                                        </StackPanel>
                                    </StackPanel>
                                </DataTemplate>
                            </xcdg:UnboundColumn.CellContentTemplate>
                        </xcdg:UnboundColumn>
                    </xcdg:DataGridControl.Columns>
                </xcdg:DataGridControl>-->
            </DockPanel>

            <GridSplitter Grid.Row="1"
                          Width="5"
                          HorizontalAlignment="Stretch"
                          ResizeBehavior="PreviousAndNext"
                          ResizeDirection="Columns" />

            <Expander Grid.Row="2"
                      Margin="5"
                      ExpandDirection="Up">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top" Text="Log:" />
                    <TextBox AcceptsReturn="True"
                             IsReadOnly="True"
                             ScrollViewer.VerticalScrollBarVisibility="Auto"
                             Text="{Binding Path=LogOutputToWindow,
                                            Mode=OneWay,
                                            UpdateSourceTrigger=PropertyChanged}" />
                </DockPanel>
            </Expander>
        </Grid>
    </DockPanel>
</controls:MetroWindow>